/**
 * @typedef {object} NodePin
 * @property {string} id - Unique pin identifier (e.g., "exec", "data_result").
 * @property {string} name - Human-readable pin name.
 * @property {string} type - Pin data type ("Exec", "String", "Boolean", etc.).
 * @property {boolean} [required] - Whether this pin is required.
 */

/**
 * @typedef {object} NodeConfig
 * @property {string} type - Unique node type identifier (e.g., "action:send_message").
 * @property {string} label - Human-readable node name.
 * @property {string} category - Category for UI grouping.
 * @property {string} description - Node description.
 * @property {NodePin[]} inputs - Array of input pin descriptions.
 * @property {NodePin[]} outputs - Array of output pin descriptions.
 * @property {Function} [executor] - Function to execute this node (for backend).
 */

/**
 * Registry for managing all available node types.
 */
class NodeRegistry {
  constructor() {
    this.nodes = new Map();
    this._registerBaseNodes();
  }

  /**
   * Registers a new node type.
   * @param {NodeConfig} nodeConfig - Node configuration.
   */
  registerNodeType(nodeConfig) {
    if (!nodeConfig.type) {
      throw new Error('Node type is required');
    }
    
    if (this.nodes.has(nodeConfig.type)) {
      console.warn(`Node type '${nodeConfig.type}' is already registered. Overriding.`);
    }

    this.nodes.set(nodeConfig.type, nodeConfig);
    console.log(`Registered node type: ${nodeConfig.type}`);
  }

  /**
   * Gets a node configuration by type.
   * @param {string} nodeType - Node type identifier.
   * @returns {NodeConfig|undefined}
   */
  getNodeConfig(nodeType) {
    return this.nodes.get(nodeType);
  }

  /**
   * Gets all registered node types.
   * @returns {NodeConfig[]}
   */
  getAllNodes() {
    return Array.from(this.nodes.values());
  }

  /**
   * Gets nodes grouped by category.
   * @param {string} [graphType] - The type of graph ('command' or 'event') to filter nodes for.
   * @returns {Object.<string, NodeConfig[]>}
   */
  getNodesByCategory(graphType) {
    const result = {};
    for (const node of this.nodes.values()) {
      if (node.graphType === 'all' || node.graphType === graphType) {
        if (!result[node.category]) {
          result[node.category] = [];
        }
        result[node.category].push(node);
      }
    }
    return result;
  }

  /**
   * Validates if a node type exists.
   * @param {string} nodeType - Node type identifier.
   * @returns {boolean}
   */
  hasNodeType(nodeType) {
    return this.nodes.has(nodeType);
  }

  /**
   * Registers the base node library.
   * @private
   */
  _registerBaseNodes() {
    const all = 'all';
    const command = 'command';
    const event = 'event';

    // –°–æ–±—ã—Ç–∏—è
    this.registerNodeType({
      type: 'event:command',
      label: '‚ñ∂Ô∏è –ü—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∫–æ–º–∞–Ω–¥—ã',
      category: '–°–æ–±—ã—Ç–∏—è',
      description: '–°—Ç–∞—Ä—Ç–æ–≤–∞—è —Ç–æ—á–∫–∞ –¥–ª—è –≥—Ä–∞—Ñ–∞ –∫–æ–º–∞–Ω–¥—ã.',
      graphType: command,
      pins: {
        inputs: [],
        outputs: [
          { id: 'exec', name: '–í—ã–ø–æ–ª–Ω–∏—Ç—å', type: 'Exec' },
          { id: 'user', name: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å', type: 'User' },
          { id: 'args', name: '–ê—Ä–≥—É–º–µ–Ω—Ç—ã', type: 'Object' },
          { id: 'chat_type', name: '–¢–∏–ø —á–∞—Ç–∞', type: 'String' }
        ]
      }
    });

    this.registerNodeType({
        type: 'event:chat',
        name: '–°–æ–±—ã—Ç–∏–µ: –°–æ–æ–±—â–µ–Ω–∏–µ –≤ —á–∞—Ç–µ',
        label: 'üí¨ –°–æ–æ–±—â–µ–Ω–∏–µ –≤ —á–∞—Ç–µ',
        description: '–°—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç, –∫–æ–≥–¥–∞ –≤ —á–∞—Ç –ø—Ä–∏—Ö–æ–¥–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ.',
        category: '–°–æ–±—ã—Ç–∏—è',
        graphType: event,
        isEvent: true,
        pins: {
            inputs: [],
            outputs: [
                { id: 'exec', type: 'Exec', name: '–í—ã–ø–æ–ª–Ω–∏—Ç—å' },
                { id: 'username', type: 'String', name: '–ò–≥—Ä–æ–∫' },
                { id: 'message', type: 'String', name: '–°–æ–æ–±—â–µ–Ω–∏–µ' },
                { id: 'chatType', type: 'String', name: '–¢–∏–ø —á–∞—Ç–∞' },
                { id: 'raw', type: 'String', name: 'Raw JSON' },
            ]
        }
    });

    this.registerNodeType({
      type: 'event:playerJoined',
      label: 'üëã –ò–≥—Ä–æ–∫ –∑–∞—à–µ–ª',
      category: '–°–æ–±—ã—Ç–∏—è',
      description: '–°—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç, –∫–æ–≥–¥–∞ –∏–≥—Ä–æ–∫ –∑–∞—Ö–æ–¥–∏—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä.',
      graphType: event,
      pins: {
        inputs: [],
        outputs: [
          { id: 'exec', name: '–í—ã–ø–æ–ª–Ω–∏—Ç—å', type: 'Exec' },
          { id: 'user', name: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å', type: 'User' },
        ]
      }
    });

    this.registerNodeType({
      type: 'event:playerLeft',
      label: 'üö™ –ò–≥—Ä–æ–∫ –≤—ã—à–µ–ª',
      category: '–°–æ–±—ã—Ç–∏—è',
      description: '–°—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç, –∫–æ–≥–¥–∞ –∏–≥—Ä–æ–∫ –ø–æ–∫–∏–¥–∞–µ—Ç —Å–µ—Ä–≤–µ—Ä.',
      graphType: event,
      pins: {
        inputs: [],
        outputs: [
          { id: 'exec', name: '–í—ã–ø–æ–ª–Ω–∏—Ç—å', type: 'Exec' },
          { id: 'user', name: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å', type: 'User' },
        ]
      }
    });

    this.registerNodeType({
      type: 'event:entitySpawn',
      label: 'üì¶ –°—É—â–Ω–æ—Å—Ç—å –ø–æ—è–≤–∏–ª–∞—Å—å',
      category: '–°–æ–±—ã—Ç–∏—è',
      description: '–í—ã–∑—ã–≤–∞–µ—Ç—Å—è, –∫–æ–≥–¥–∞ –Ω–æ–≤–∞—è —Å—É—â–Ω–æ—Å—Ç—å –ø–æ—è–≤–ª—è–µ—Ç—Å—è –≤ –ø–æ–ª–µ –∑—Ä–µ–Ω–∏—è –±–æ—Ç–∞.',
      graphType: event,
      pins: {
        inputs: [],
        outputs: [
          { id: 'exec', name: '–í—ã–ø–æ–ª–Ω–∏—Ç—å', type: 'Exec' },
          { id: 'entity', name: '–°—É—â–Ω–æ—Å—Ç—å', type: 'Object' }
        ]
      }
    });

    this.registerNodeType({
      type: 'event:entityMoved',
      label: 'üßç –°—É—â–Ω–æ—Å—Ç—å –ø–æ–¥–≤–∏–Ω—É–ª–∞—Å—å',
      category: '–°–æ–±—ã—Ç–∏—è',
      description: '–í—ã–∑—ã–≤–∞–µ—Ç—Å—è, –∫–æ–≥–¥–∞ –ª—é–±–∞—è —Å—É—â–Ω–æ—Å—Ç—å –ø–µ—Ä–µ–º–µ—â–∞–µ—Ç—Å—è.',
      graphType: event,
      pins: {
        inputs: [],
        outputs: [
          { id: 'exec', name: '–í—ã–ø–æ–ª–Ω–∏—Ç—å', type: 'Exec' },
          { id: 'entity', name: '–°—É—â–Ω–æ—Å—Ç—å', type: 'Object' }
        ]
      }
    });
    
    this.registerNodeType({
      type: 'event:entityGone',
      label: '‚ùå –°—É—â–Ω–æ—Å—Ç—å –∏—Å—á–µ–∑–ª–∞',
      category: '–°–æ–±—ã—Ç–∏—è',
      description: '–í—ã–∑—ã–≤–∞–µ—Ç—Å—è, –∫–æ–≥–¥–∞ —Å—É—â–Ω–æ—Å—Ç—å –ø—Ä–æ–ø–∞–¥–∞–µ—Ç –∏–∑ –∑–æ–Ω—ã –≤–∏–¥–∏–º–æ—Å—Ç–∏ –±–æ—Ç–∞.',
      graphType: event,
      pins: {
        inputs: [],
        outputs: [
          { id: 'exec', name: '–í—ã–ø–æ–ª–Ω–∏—Ç—å', type: 'Exec' },
          { id: 'entity', name: '–°—É—â–Ω–æ—Å—Ç—å', type: 'Object' }
        ]
      }
    });

    this.registerNodeType({
      type: 'flow:branch',
      label: '‚ÜîÔ∏è –í–µ—Ç–≤–ª–µ–Ω–∏–µ (Branch)',
      category: '–ü–æ—Ç–æ–∫',
      description: 'if/else –ª–æ–≥–∏–∫–∞',
      graphType: all,
      pins: {
        inputs: [
          { id: 'exec', name: '–í—ã–ø–æ–ª–Ω–∏—Ç—å', type: 'Exec', required: true },
          { id: 'condition', name: '–£—Å–ª–æ–≤–∏–µ', type: 'Boolean', required: true }
        ],
        outputs: [
          { id: 'exec_true', name: 'True', type: 'Exec' },
          { id: 'exec_false', name: 'False', type: 'Exec' }
        ]
      }
    });

    this.registerNodeType({
      type: 'flow:sequence',
      label: '‚õìÔ∏è –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å',
      category: '–ü–æ—Ç–æ–∫',
      description: '–í—ã–ø–æ–ª–Ω—è–µ—Ç –¥–µ–π—Å—Ç–≤–∏—è –ø–æ –æ—á–µ—Ä–µ–¥–∏',
      graphType: all,
      pins: {
        inputs: [
          { id: 'exec', name: '–í—ã–ø–æ–ª–Ω–∏—Ç—å', type: 'Exec', required: true }
        ],
        outputs: [
          { id: 'exec_0', name: '0', type: 'Exec' },
          { id: 'exec_1', name: '1', type: 'Exec' }
        ]
      }
    });

    this.registerNodeType({
      type: 'action:send_message',
      label: 'üó£Ô∏è –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ',
      category: '–î–µ–π—Å—Ç–≤–∏—è',
      description: '–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —á–∞—Ç',
      graphType: all,
      pins: {
        inputs: [
          { id: 'exec', name: '–í—ã–ø–æ–ª–Ω–∏—Ç—å', type: 'Exec', required: true },
          { id: 'chat_type', name: '–¢–∏–ø —á–∞—Ç–∞', type: 'String', required: true },
          { id: 'message', name: '–°–æ–æ–±—â–µ–Ω–∏–µ', type: 'String', required: true },
          { id: 'recipient', name: '–ê–¥—Ä–µ—Å–∞—Ç', type: 'String', required: false }
        ],
        outputs: [
          { id: 'exec', name: '–í—ã–ø–æ–ª–Ω–µ–Ω–æ', type: 'Exec' }
        ]
      }
    });

    this.registerNodeType({
        type: 'action:send_log',
        label: 'üìù –ó–∞–ø–∏—Å–∞—Ç—å –≤ –ª–æ–≥ (–≤–µ–±)',
        category: '–î–µ–π—Å—Ç–≤–∏—è',
        description: '–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –∫–æ–Ω—Å–æ–ª—å –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –±–æ—Ç–∞.',
        graphType: all,
        pins: {
            inputs: [
                { id: 'exec', name: '–í—ã–ø–æ–ª–Ω–∏—Ç—å', type: 'Exec', required: true },
                { id: 'message', name: '–°–æ–æ–±—â–µ–Ω–∏–µ', type: 'String', required: true },
            ],
            outputs: [
                { id: 'exec', name: '–í—ã–ø–æ–ª–Ω–µ–Ω–æ', type: 'Exec' },
            ]
        }
    });

    this.registerNodeType({
      type: 'action:bot_look_at',
      label: 'ü§ñ –ë–æ—Ç: –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –Ω–∞',
      category: '–î–µ–π—Å—Ç–≤–∏—è',
      description: '–ü–æ–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç –≥–æ–ª–æ–≤—É –±–æ—Ç–∞ –≤ —Å—Ç–æ—Ä–æ–Ω—É –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –∏–ª–∏ —Å—É—â–Ω–æ—Å—Ç–∏.',
      graphType: all,
      pins: {
        inputs: [
          { id: 'exec', name: '–í—ã–ø–æ–ª–Ω–∏—Ç—å', type: 'Exec', required: true },
          { id: 'target', name: '–¶–µ–ª—å (–ü–æ–∑–∏—Ü–∏—è/–°—É—â–Ω–æ—Å—Ç—å)', type: 'Object', required: true },
          { id: 'add_y', name: '–ü—Ä–∏–±–∞–≤–∏—Ç—å –∫ Y', type: 'Number', required: false }
        ],
        outputs: [
          { id: 'exec', name: '–í—ã–ø–æ–ª–Ω–µ–Ω–æ', type: 'Exec' }
        ]
      }
    });
    
    this.registerNodeType({
      type: 'action:bot_set_variable',
      label: 'üíæ –ó–∞–ø–∏—Å–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é',
      category: '–î–µ–π—Å—Ç–≤–∏—è',
      description: '–°–æ—Ö—Ä–∞–Ω—è–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –≥—Ä–∞—Ñ–∞.',
      graphType: event,
      pins: {
          inputs: [
              { id: 'exec', name: '–í—ã–ø–æ–ª–Ω–∏—Ç—å', type: 'Exec', required: true },
              { id: 'name', name: '–ò–º—è', type: 'String', required: true },
              { id: 'value', name: '–ó–Ω–∞—á–µ–Ω–∏–µ', type: 'Wildcard', required: true },
              { id: 'persist', name: '–•—Ä–∞–Ω–∏—Ç—å –≤ –ë–î?', type: 'Boolean', required: false }
          ],
          outputs: [
              { id: 'exec', name: '–í—ã–ø–æ–ª–Ω–µ–Ω–æ', type: 'Exec' }
          ]
      }
    });

    this.registerNodeType({
      type: 'data:get_argument',
      label: 'üì• –ü–æ–ª—É—á–∏—Ç—å –∞—Ä–≥—É–º–µ–Ω—Ç',
      category: '–î–∞–Ω–Ω—ã–µ',
      description: '–ü–æ–ª—É—á–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –∞—Ä–≥—É–º–µ–Ω—Ç–∞ –∫–æ–º–∞–Ω–¥—ã.',
      graphType: command,
      pins: {
        inputs: [
          { id: 'arg_name', name: '–ò–º—è –∞—Ä–≥—É–º–µ–Ω—Ç–∞', type: 'String', required: true },
        ],
        outputs: [
          { id: 'value', name: '–ó–Ω–∞—á–µ–Ω–∏–µ', type: 'Wildcard' },
          { id: 'exists', name: '–°—É—â–µ—Å—Ç–≤—É–µ—Ç', type: 'Boolean' },
        ]
      }
    });

    this.registerNodeType({
        type: 'data:get_variable',
        label: 'üì§ –ü–æ–ª—É—á–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é',
        category: '–î–∞–Ω–Ω—ã–µ',
        description: '–ü–æ–ª—É—á–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –≥—Ä–∞—Ñ–∞.',
        graphType: event,
        pins: {
            inputs: [],
            outputs: [
                { id: 'value', name: '–ó–Ω–∞—á–µ–Ω–∏–µ', type: 'Wildcard' }
            ]
        }
    });
    
    this.registerNodeType({
      type: 'data:get_entity_field',
      label: 'üì¶ –ü–æ–ª—É—á–∏—Ç—å –ø–æ–ª–µ —Å—É—â–Ω–æ—Å—Ç–∏',
      category: '–î–∞–Ω–Ω—ã–µ',
      description: '–ü–æ–ª—É—á–∞–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–µ –ø–æ–ª–µ –∏–∑ –æ–±—ä–µ–∫—Ç–∞ —Å—É—â–Ω–æ—Å—Ç–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "position.x", "username").',
      graphType: all,
      pins: {
        inputs: [
          { id: 'entity', name: '–°—É—â–Ω–æ—Å—Ç—å', type: 'Object', required: true },
        ],
        outputs: [
          { id: 'username', name: '–ù–∏–∫–Ω–µ–π–º', type: 'String' },
          { id: 'type', name: '–¢–∏–ø', type: 'String' },
          { id: 'position', name: '–ü–æ–∑–∏—Ü–∏—è', type: 'Object' },
          { id: 'isValid', name: '–í–∞–ª–∏–¥–Ω–∞', type: 'Boolean' },
        ]
      }
    });
    
    this.registerNodeType({
      type: 'data:string_literal',
      label: 'üìú –°—Ç—Ä–æ–∫–∞',
      category: '–î–∞–Ω–Ω—ã–µ',
      description: '–ü—Ä–æ—Å—Ç–æ–µ —Ç–µ–∫—Å—Ç–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ.',
      graphType: all,
      pins: {
        inputs: [],
        outputs: [
          { id: 'value', name: '–ó–Ω–∞—á–µ–Ω–∏–µ', type: 'String' }
        ]
      }
    });

    this.registerNodeType({
      type: 'data:number_literal',
      label: 'üî¢ –ß–∏—Å–ª–æ',
      category: '–î–∞–Ω–Ω—ã–µ',
      description: '–ü—Ä–æ—Å—Ç–æ–µ —á–∏—Å–ª–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ.',
      graphType: all,
      pins: {
        inputs: [
          { id: 'value', name: '–ó–Ω–∞—á–µ–Ω–∏–µ', type: 'Number', required: true }
        ],
        outputs: [
          { id: 'value', name: '–ó–Ω–∞—á–µ–Ω–∏–µ', type: 'Number' }
        ]
      }
    });

    this.registerNodeType({
      type: 'data:boolean_literal',
      label: '‚úîÔ∏è –ë—É–ª–µ–≤–æ',
      category: '–î–∞–Ω–Ω—ã–µ',
      description: '–ó–Ω–∞—á–µ–Ω–∏–µ –ò—Å—Ç–∏–Ω–∞/–õ–æ–∂—å.',
      graphType: all,
      pins: {
        inputs: [
          { id: 'value', name: '–ó–Ω–∞—á–µ–Ω–∏–µ', type: 'Boolean', required: true }
        ],
        outputs: [
          { id: 'value', name: '–ó–Ω–∞—á–µ–Ω–∏–µ', type: 'Boolean' }
        ]
      }
    });

    this.registerNodeType({
      type: 'data:array_literal',
      label: 'üìã –ú–∞—Å—Å–∏–≤',
      category: '–î–∞–Ω–Ω—ã–µ',
      description: '–°–æ–∑–¥–∞–µ—Ç –º–∞—Å—Å–∏–≤ –∏–∑ —ç–ª–µ–º–µ–Ω—Ç–æ–≤.',
      graphType: all,
      dynamicPins: true,
      pins: {
        inputs: [],
        outputs: [
          { id: 'value', name: '–ú–∞—Å—Å–∏–≤', type: 'Array' }
        ]
      }
    });
    
    this.registerNodeType({
      type: 'data:make_object',
      label: 'üèóÔ∏è –°–æ–±—Ä–∞—Ç—å –æ–±—ä–µ–∫—Ç',
      category: '–î–∞–Ω–Ω—ã–µ',
      description: '–°–æ–∑–¥–∞–µ—Ç JSON-–æ–±—ä–µ–∫—Ç –∏–∑ –ø–∞—Ä –∫–ª—é—á-–∑–Ω–∞—á–µ–Ω–∏–µ.',
      graphType: all,
      dynamicPins: true,
      pins: {
        inputs: [],
        outputs: [
          { id: 'value', name: '–û–±—ä–µ–∫—Ç', type: 'Object' }
        ]
      }
    });

    this.registerNodeType({
      type: 'data:cast',
      label: '‚ú® –ü—Ä–∏–≤–µ–¥–µ–Ω–∏–µ —Ç–∏–ø–æ–≤',
      category: '–î–∞–Ω–Ω—ã–µ',
      description: '–ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑ –æ–¥–Ω–æ–≥–æ —Ç–∏–ø–∞ –≤ –¥—Ä—É–≥–æ–π.',
      graphType: all,
      pins: {
        inputs: [
          { id: 'exec_in', name: 'Exec', type: 'Exec' },
          { id: 'value', name: '–ó–Ω–∞—á–µ–Ω–∏–µ', type: 'Wildcard', required: true },
          { id: 'target_type', name: '–¶–µ–ª–µ–≤–æ–π —Ç–∏–ø', type: 'String', required: true }
        ],
        outputs: [
          { id: 'exec_out', name: 'Exec', type: 'Exec' },
          { id: 'value', name: '–ó–Ω–∞—á–µ–Ω–∏–µ', type: 'Wildcard' }
        ]
      }
    });

    this.registerNodeType({
      type: 'string:contains',
      label: 'üîç –°—Ç—Ä–æ–∫–∞: –°–æ–¥–µ—Ä–∂–∏—Ç',
      category: '–°—Ç—Ä–æ–∫–∏',
      description: '–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —Å–æ–¥–µ—Ä–∂–∏—Ç –ª–∏ –æ–¥–Ω–∞ —Å—Ç—Ä–æ–∫–∞ –¥—Ä—É–≥—É—é.',
      graphType: all,
      pins: {
        inputs: [
          { id: 'exec', name: 'Exec', type: 'Exec', required: true },
          { id: 'haystack', name: '–°—Ç—Ä–æ–∫–∞', type: 'String', required: true },
          { id: 'needle', name: '–ü–æ–¥—Å—Ç—Ä–æ–∫–∞', type: 'String', required: true },
          { id: 'case_sensitive', name: '–£—á–µ—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞', type: 'Boolean', required: false }
        ],
        outputs: [
          { id: 'exec', name: 'Exec', type: 'Exec' },
          { id: 'result', name: '–†–µ–∑—É–ª—å—Ç–∞—Ç', type: 'Boolean' }
        ]
      }
    });

    this.registerNodeType({
      type: 'string:equals',
      label: '–°—Ç—Ä–æ–∫–∞: –†–∞–≤–Ω–æ',
      category: '–°—Ç—Ä–æ–∫–∏',
      description: '–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —Ä–∞–≤–Ω—ã –ª–∏ —Å—Ç—Ä–æ–∫–∏ (—Å —É—á–µ—Ç–æ–º/–±–µ–∑ —É—á–µ—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞).',
      graphType: all,
      pins: {
        inputs: [
          { id: 'exec', name: 'Exec', type: 'Exec', required: true },
          { id: 'a', name: 'A', type: 'String', required: true },
          { id: 'b', name: 'B', type: 'String', required: true },
          { id: 'case_sensitive', name: '–£—á–µ—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞', type: 'Boolean', required: false }
        ],
        outputs: [
          { id: 'exec', name: 'Exec', type: 'Exec' },
          { id: 'result', name: '–†–µ–∑—É–ª—å—Ç–∞—Ç', type: 'Boolean' }
        ]
      }
    });

    this.registerNodeType({
      type: 'string:starts_with',
      label: '–°—Ç—Ä–æ–∫–∞: –ù–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å',
      category: '–°—Ç—Ä–æ–∫–∏',
      description: '–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –ª–∏ —Å—Ç—Ä–æ–∫–∞ —Å —É–∫–∞–∑–∞–Ω–Ω–æ–π –ø–æ–¥—Å—Ç—Ä–æ–∫–∏.',
      graphType: all,
      pins: {
        inputs: [
          { id: 'exec', name: 'Exec', type: 'Exec', required: true },
          { id: 'string', name: '–°—Ç—Ä–æ–∫–∞', type: 'String', required: true },
          { id: 'prefix', name: '–ü—Ä–µ—Ñ–∏–∫—Å', type: 'String', required: true },
          { id: 'case_sensitive', name: '–£—á–µ—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞', type: 'Boolean', required: false }
        ],
        outputs: [
          { id: 'exec', name: 'Exec', type: 'Exec' },
          { id: 'result', name: '–†–µ–∑—É–ª—å—Ç–∞—Ç', type: 'Boolean' }
        ]
      }
    });

    this.registerNodeType({
      type: 'string:ends_with',
      label: '–°—Ç—Ä–æ–∫–∞: –ó–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è –Ω–∞',
      category: '–°—Ç—Ä–æ–∫–∏',
      description: '–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è –ª–∏ —Å—Ç—Ä–æ–∫–∞ —É–∫–∞–∑–∞–Ω–Ω–æ–π –ø–æ–¥—Å—Ç—Ä–æ–∫–æ–π.',
      graphType: all,
      pins: {
        inputs: [
          { id: 'exec', name: 'Exec', type: 'Exec', required: true },
          { id: 'string', name: '–°—Ç—Ä–æ–∫–∞', type: 'String', required: true },
          { id: 'suffix', name: '–°—É—Ñ—Ñ–∏–∫—Å', type: 'String', required: true },
          { id: 'case_sensitive', name: '–£—á–µ—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞', type: 'Boolean', required: false }
        ],
        outputs: [
          { id: 'exec', name: 'Exec', type: 'Exec' },
          { id: 'result', name: '–†–µ–∑—É–ª—å—Ç–∞—Ç', type: 'Boolean' }
        ]
      }
    });

    this.registerNodeType({
      type: 'string:length',
      label: '–°—Ç—Ä–æ–∫–∞: –î–ª–∏–Ω–∞',
      category: '–°—Ç—Ä–æ–∫–∏',
      description: '–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–∏–º–≤–æ–ª–æ–≤ –≤ —Å—Ç—Ä–æ–∫–µ.',
      graphType: all,
      pins: {
        inputs: [
          { id: 'exec', name: 'Exec', type: 'Exec', required: true },
          { id: 'string', name: '–°—Ç—Ä–æ–∫–∞', type: 'String', required: true }
        ],
        outputs: [
          { id: 'exec', name: 'Exec', type: 'Exec' },
          { id: 'length', name: '–î–ª–∏–Ω–∞', type: 'Number' }
        ]
      }
    });

    this.registerNodeType({
      type: 'string:split',
      label: '–°—Ç—Ä–æ–∫–∞: –†–∞–∑–¥–µ–ª–∏—Ç—å',
      category: '–°—Ç—Ä–æ–∫–∏',
      description: '–†–∞–∑–¥–µ–ª—è–µ—Ç —Å—Ç—Ä–æ–∫—É –Ω–∞ –º–∞—Å—Å–∏–≤ –ø–æ–¥—Å—Ç—Ä–æ–∫ –ø–æ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—é.',
      graphType: all,
      pins: {
        inputs: [
          { id: 'exec', name: 'Exec', type: 'Exec', required: true },
          { id: 'string', name: '–°—Ç—Ä–æ–∫–∞', type: 'String', required: true },
          { id: 'separator', name: '–†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å', type: 'String', required: true }
        ],
        outputs: [
          { id: 'exec', name: 'Exec', type: 'Exec' },
          { id: 'array', name: '–ú–∞—Å—Å–∏–≤', type: 'Array' }
        ]
      }
    });

    this.registerNodeType({
      type: 'string:concat',
      label: '–°—Ç—Ä–æ–∫–∞: –û–±—ä–µ–¥–∏–Ω–∏—Ç—å',
      category: '–°—Ç—Ä–æ–∫–∏',
      description: '–û–±—ä–µ–¥–∏–Ω—è–µ—Ç –¥–≤–µ –∏–ª–∏ –±–æ–ª–µ–µ —Å—Ç—Ä–æ–∫–∏ –≤ –æ–¥–Ω—É.',
      graphType: all,
      dynamicPins: true,
      pins: {
        inputs: [],
        outputs: [
          { id: 'result', name: '–†–µ–∑—É–ª—å—Ç–∞—Ç', type: 'String' }
        ]
      }
    });

    this.registerNodeType({
      type: 'math:operation',
      label: 'üî¢ –ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞',
      category: '–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞',
      description: '–í—ã–ø–æ–ª–Ω—è–µ—Ç –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫—É—é –æ–ø–µ—Ä–∞—Ü–∏—é –Ω–∞–¥ –¥–≤—É–º—è —á–∏—Å–ª–∞–º–∏.',
      graphType: all,
      pins: {
        inputs: [
          { id: 'a', name: 'A', type: 'Number', required: true },
          { id: 'b', name: 'B', type: 'Number', required: true }
        ],
        outputs: [
          { id: 'result', name: '–†–µ–∑—É–ª—å—Ç–∞—Ç', type: 'Number' }
        ]
      }
    });

    this.registerNodeType({
      type: 'logic:operation',
      label: 'üí° –õ–æ–≥–∏–∫–∞',
      category: '–õ–æ–≥–∏–∫–∞',
      description: '–í—ã–ø–æ–ª–Ω—è–µ—Ç –ª–æ–≥–∏—á–µ—Å–∫—É—é –æ–ø–µ—Ä–∞—Ü–∏—é. –î–ª—è –ù–ï (NOT) –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤—Ö–æ–¥ –ê.',
      graphType: all,
      dynamicPins: true,
      pins: {
        inputs: [
          { id: 'a', name: 'A', type: 'Boolean', required: true },
          { id: 'b', name: 'B', type: 'Boolean', required: true }
        ],
        outputs: [
          { id: 'result', name: '–†–µ–∑—É–ª—å—Ç–∞—Ç', type: 'Boolean' }
        ]
      }
    });

    this.registerNodeType({
      type: 'debug:log',
      label: 'üêû –û—Ç–ª–∞–¥–∫–∞ (–∫–æ–Ω—Å–æ–ª—å)',
      category: '–û—Ç–ª–∞–¥–∫–∞',
      description: '–í—ã–≤–æ–¥–∏—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –≤ –∫–æ–Ω—Å–æ–ª—å —Ç–µ—Ä–º–∏–Ω–∞–ª–∞, –≥–¥–µ –∑–∞–ø—É—â–µ–Ω –±–æ—Ç.',
      graphType: all,
      pins: {
        inputs: [
          { id: 'exec_in', name: 'Exec', type: 'Exec' },
          { id: 'value', name: '–ó–Ω–∞—á–µ–Ω–∏–µ', type: 'Wildcard', required: true }
        ],
        outputs: [
          { id: 'exec_out', name: 'Exec', type: 'Exec' }
        ]
      }
    });

    console.log(`NodeRegistry: Registered ${this.nodes.size} base nodes`);
  }

  getNodesByTypes(types) {
    return types.map(type => this.nodes.get(type)).filter(Boolean);
  }
}

const nodeRegistryInstance = new NodeRegistry();
module.exports = nodeRegistryInstance;
